---
title: "CubOps: Manual de Usuario"
author: "Julio Sergio Santana"
date: "19 de enero de 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 1 Introducción

**CubOps** es una aplicación Web que le permitirá operar sobre un conjunto de puntos, típicamente estaciones meteorológicas, cada uno de los cuales contiene infromación temporal de un número finito de variables, como pueden ser, precipitación, temperaturas mínimas y máximas.

En general, el sistema trabaja con puntos a los que se le ha asociado un número de variables cualquiera, que dependen de una fecha secuencial en días.

Para el análisis y la aplicación de operaciones o producción de algunos gráficos, el sistema permite generar una tabla completa para una variable seleccionada, cada una de cuyas columnas corresponde a cada uno de los puntos o estaciones de la base de datos. Posteriormente, se pueden aplicar operaciones estadísticas (media, rango, mediana, _quantile_, etc.), a los datos de la columna, o a una selección de esta de acuerdo con las fechas establecidas. El sistema también permite la producción de varios tipos de gráficos simples para las columnas de las tablas resultantes, a saber: histogramas, _boxplots_, o series de tiempo.

En cualquier momento, el usuario puede descargar las tablas resultantes de sus operaciones en un formato estándar (csv), que podrá ser leído fácilmente por hojas de cálculo, tales como _LibreOffice Calc_, o _Excel_, o por otros sistemas o programas para desarrollar procesos adicionales con la información.

# 2 Aspecto general de CubOps

Para ejecutar el sistema basta con introducir la siguiente URL en alguno de los _browsers_ comunes de la Web, tales como Chrome o Firefox:

http://172.16.19.27:3838/CubOps

El sistema desplegará una interfaz al usuario, en la cual podrá introducir sus peticiones y recibir sus respuestas. La Fig. 1 Muestra la apariencia general del sistema una vez que se han desarrollado varias operaciones. Al inicio de la sesión, sólo se muestra el menú etiquetado como **Acción**, en el área **A** de la Fig. 1, y las áreas **B** y **C** se muestran vacías, aunque, al pulsar en la pestaña etiquetada como **Manual**, en el área **B**, se desplegará el presente documento.

**Figura 1.** Apariencia general de CubOps

![Apariencia CubOps](CubOpsGral.png)

En esa figura se destacan la tres áreas principales del sistema, a saber:

1. **A**. Panel de acciones. Aquí el usuario define diversas acciones que van desde la captura de sus datos, hasta la operación sobre algún subconjunto de ellos para definir alguna estadística.
1. **B**. Panel de resultados tabulares. Los resultados tabulares de las operaciones se muestran en este espacio.
1. **C**. Panel de operaciones y resultados gráficos. Aquí el usuario puede definir diversos tipos de gráfico para alguna de las columnas del resultado tabular.

# 3 Los datos y su recolección

Generalmente, los datos de cada estación estarán dados como una tabla en la que se proporciona una fecha en cada renglón y con una columna para cada una de las variables que se han registrado para la estación a lo largo del tiempo. En seguida se muestran los diez primeros renglones de una estación con tres variables: Prec (precipitación), Tmax (temperatura máxima) y Tmin (temperatura mínima).

```{r tabEst, echo=FALSE}
head(read.csv("1951-2010/s27001H.csv"), 10)
```

De esta forma los datos de cada estación se pueden mantener en un archivo de hoja de cálculo, como LibreOffice Calc o Excel. Para su manejo en el presente sistema, dichos archivos deberán exportarse al formato estándar CSV ( _comma separated value_ ), aunque ellos podrán estar dispersos en una estructura de directorios o carpetas.

Los archivos CSV pudieran no traer el encabezado que identifica a cada una de las columnas, pero en ese caso el sistema entenderá que, aparte de la fecha que se debe dar en las primeras tres columnas, las columnas restantes serán sólo tres que corresponderán a las variables pp (precipitación), tmax (temperatura máxima) y tmin (temperatura mínima), en ese orden.

## 3.1 Los archivos y sus nombres

Para poder manejar dentro del sistema un conjunto de archivos de tablas como las descritas en la sección 3, éstas se pueden encontrar dispersas dentro de una estructura de directorios/subdirectorios (carpetas), del sistema operativo, tal como se muestra en la Fig. 2. Sin embargo, para que el sistema pueda reconocer los archivos en cuestión, ellos deben ser nombrados de acuerdo con una estructura sintáctica particular que se describe a continuación:

1. El primer caracter del nombre debe ser una letra "s", minúscula.
1. En seguida, una secuencia de caracteres alfanuméricos que representan el _identificador_ de la estación correspondiente al archivo.
1. Después una letra "H", mayúscula y la secuencia de caracteres ".csv", que identifican el tipo de archivo.

Por ejemplo, el archivo de nombre "s3394H.csv" contendría la tabla de información de la estación 3394 en formato CSV. A estos archivos se les denominará _archivos de estaciones_.

## 3.2 Los archivos y su estructura

Externamente, como se mustra en la Fig. 2, los archivos de estaciones podrán estar dispersos en una estructura de directorios. Internamente, la condición es que la estructura de las tablas sea la misma para todos los archivos, esto es, todos deben tener el mismo número de columnas, con las tres primeras para la fecha en orden: año, mes y día, y las restantes para las variables que se registren en las estaciones, en el mismo orden para todas las tablas. 
Si las tablas llevan o no encabezado, esto debe ser igual para todas ellas.

**Figura 2.** Ejemplo de estructura de directorios con archivos CSV

![Estruct Dir](DirStruct.png)

## 3.3 Empaquetado de los archivos

Para que el sistema pueda digerir la información correspondiente a un conjunto de estaciones como la que se ha ilustrado en las secciones anteriores y que se muestra gráficamente en la Fig. 2, es necesario empaquetarlo en un solo archivo de tipo ZIP.

En un sistema operativo Linux o Unix, el comando para efectuar esa operación es:

```{bash zip, eval=F}
zip -r arch.zip path/de/inicio
```

Al final de la operación toda la estructura  de archivos se tendría en el paquete de nombre "arch.zip", en el caso del ejemplo.

## 3.4 Información geográfica de estaciones

Aparte de la información de diversas variables de las estaciones, que se empaca en un archivo de tipo ZIP, como se ha mostrado en las secciones anteriores, es necesario proveer también de una tabla que registre las coordenadas geográficas en formato CSV. Un ejemplo de la estructura de esta tabla se muestra a continuación:


```{r tabEstGeo, echo=FALSE}
head(read.csv("Estaciones.csv"), 10)
```

La tabla debe contener por lo menos tres columnas, la correspondiente a la "Clave" de la estación, y las correspondientes a la "Longitud" y "Latitud" de la estación, con esos nombres de columna.

## 3.5 CubOps: colección de los datos

Para que el sistema colecte toda la información de las estaciones se debe seleccionar, en el menú de Acciones, la entrada "**Colecta Datos**", como se muestra en la Fig. 3.

**Figura 3.** Colección de datos

![Colecta Datos](ColeccionDatos1.png)
Una vez seleccionada esta acción el sistema provee sendos botones para la _subida_ de los dos archivos de interés, descritos en las secciones 3.3 y 3.4; esto es, el paquete de archivos ZIP con la información de las variables en las estaciones y el archivo CSV con la información geográfica de las estaciones. El despliegue de estos botones se muestra en la Fig. 4, a continuación.

**Figura 4.** Botones para la _subida_ de archivos de datos

![Sube datos](ColeccionDatos2.png)

Una vez subidos o cargados estos datos, lo cual se muestra en las barras de avance de la Fig. 5, se debe oprimir el botón "**Ejecuta**", en la parte inferior del panel de Acciones, para proceder al armado completo de la estructura de información que utiliza internamente el sistema. En la Fig. 5, se muestra el resultado, donde, en el panel de resultados tabulares, se muestra un texto que da alguna pista del armado de dicha estructura.

**Figura 5.** Armado de la estructura de información

![Estruct info](ColeccionDatos4.png)

## 3.6 Descarga y recarga de la estructura de información

Una vez construída la estructura de información, como se ha mostrado en las secciones anteriores, ésta se puede descargar de manera local para reutilizarse posteriormente por el sistema, sin necesidad de reconstruírla a partir de un archivo de tipo ZIP. La descarga se hace seleccionando la entrada "**Guardar Archivo Datos**", en el menú de acciones (ver Fig. 3). La estructura de información queda guardada en un archivo de tipo RDS, que es un archivo binario del lenguaje de programación R.

La recarga de la estructura de información, se hace seleccionando la entrada "**Lee Archivo**", en el menú de Acciones (ver Fig. 3). Una vez leído algun archivo de este tipo (RDS), el resultado sería semejante al de la construcción de la estructura que se muestra en la Fig. 5.

# 4 Selección de variables

